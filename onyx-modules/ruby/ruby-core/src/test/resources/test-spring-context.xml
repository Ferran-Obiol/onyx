<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:util="http://www.springframework.org/schema/util"
  xmlns:aop="http://www.springframework.org/schema/aop"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.5.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd"
  default-autowire="no">
  
  <bean id="activeInterviewService" class="org.obiba.onyx.core.service.impl.DefaultActiveInterviewServiceImpl">
    <property name="persistenceManager" ref="persistenceManager" />
  </bean>
  
  <bean id="activeTubeRegistrationService"
    class="org.obiba.onyx.ruby.core.service.impl.hibernate.ActiveTubeRegistrationServiceHibernateImpl" scope="session">
    <property name="sessionFactory" ref="sessionFactory" />
    <property name="persistenceManager" ref="persistenceManager" />
    <property name="activeInterviewService" ref="activeInterviewService" />
    <property name="tubeRegistrationConfigurationMap" ref="tubeRegistrationConfigurationMap" />
    
    <aop:scoped-proxy />
  </bean>
  
  <util:map id="tubeRegistrationConfigurationMap">
    <entry key="tubeRegistrationConfiguration" value-ref="tubeRegistrationConfiguration" />
  </util:map>
  
  <bean id="tubeRegistrationConfiguration" class="org.obiba.onyx.ruby.core.domain.TubeRegistrationConfiguration">
    <constructor-arg value="classpath:/config" />
    
    <property name="barcodeStructure">
      <bean class="org.obiba.onyx.ruby.core.domain.BarcodeStructure">
        <property name="parsers">
          <list>
            <bean class="org.obiba.onyx.ruby.core.domain.parser.impl.RegularExpressionBarcodePartParser">
              <property name="size" value="10" />
              <property name="expression" value=".*" />
            </bean>
          </list>
        </property>
      </bean>
    </property>
  </bean>

  <import resource="classpath:/test-hibernate-config.xml" />
  <import resource="classpath:/test-db-config.xml" />
  <import resource="classpath:META-INF/spring/ruby-core/hibernate-services.xml" />

</beans>
