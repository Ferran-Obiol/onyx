<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:tx="http://www.springframework.org/schema/tx" xmlns:aop="http://www.springframework.org/schema/aop"
  xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd">

  <tx:annotation-driven transaction-manager="transactionManager" />

  <bean name="consentDependency" class="org.obiba.onyx.engine.ConsentStageDependencyCondition">
    <property name="stageName" value="CON" />
  </bean>
  
  <bean id="quartzOnyxModule" class="org.obiba.onyx.quartz.engine.QuartzModule">
    <property name="activeInterviewService" ref="activeInterviewService" />
    <property name="stages">
      <list>
        <bean class="org.obiba.onyx.engine.Stage">
          <property name="name" value="HealthQuestionnaire" />
          <property name="module" value="quartz" />
          <property name="description" value="Health_Questionnaire" />
          <property name="displayOrder" value="12" />
          <property name="userSessionService" ref="userSessionService" />
          <property name="stageDependencyCondition" ref="consentDependency" />
        </bean>
      </list>
    </property>
  </bean>

  <bean id="quartzWaitingState" parent="baseQuartzStageState" class="org.obiba.onyx.quartz.engine.state.QuartzWaitingState"
    scope="prototype"/>

  <bean id="quartzReadyState" parent="baseQuartzStageState" class="org.obiba.onyx.quartz.engine.state.QuartzReadyState"
    scope="prototype"/>

  <bean id="quartzNotApplicableState" parent="baseQuartzStageState"
    class="org.obiba.onyx.quartz.engine.state.QuartzNotApplicableState" scope="prototype"/>

  <bean id="quartzInProgressState" parent="baseQuartzStageState"
    class="org.obiba.onyx.quartz.engine.state.QuartzInProgressState" scope="prototype"/>

  <bean id="quartzSkippedState" parent="baseQuartzStageState" class="org.obiba.onyx.quartz.engine.state.QuartzSkippedState"
    scope="prototype"/>

  <bean id="quartzCompletedState" parent="baseQuartzStageState"
    class="org.obiba.onyx.quartz.engine.state.QuartzCompletedState" scope="prototype"/>

  <bean id="quartzInterruptedState" parent="baseQuartzStageState"
    class="org.obiba.onyx.quartz.engine.state.QuartzInterruptedState" scope="prototype"/>
  
  <bean id="baseQuartzStageState" parent="baseStageState" class="org.obiba.onyx.quartz.engine.state.AbstractQuartzStageState" abstract="true">
    <property name="questionnaireParticipantService" ref="questionnaireParticipantService" />
    <property name="activeQuestionnaireAdministrationService" ref="activeQuestionnaireAdministrationService" />
  </bean>
  
  <bean id="navigationStrategy"
    class="org.obiba.onyx.quartz.core.service.impl.DefaultNavigationStrategyImpl" />
  
  <!-- Questionnaire UI factories -->
  <bean id="quartz.DefaultPageLayoutFactory" class="org.obiba.onyx.quartz.core.wicket.layout.impl.DefaultPageLayoutFactory" />
  
  <bean id="quartz.DefaultQuestionPanelFactory" class="org.obiba.onyx.quartz.core.wicket.layout.impl.DefaultQuestionPanelFactory" />
  
  <bean id="pageLayoutFactoryRegistry" class="org.obiba.onyx.quartz.core.wicket.layout.PageLayoutFactoryRegistry" />
  
  <bean id="questionPanelFactoryRegistry" class="org.obiba.onyx.quartz.core.wicket.layout.QuestionPanelFactoryRegistry" />
  
  <bean id="questionnaireUIFactoryRegistrationListener" class="org.obiba.onyx.quartz.core.wicket.layout.QuestionnaireUIFactoryRegistrationListener">
    <property name="pageLayoutFactoryRegistry" ref="pageLayoutFactoryRegistry" />
    <property name="questionPanelFactoryRegistry" ref="questionPanelFactoryRegistry" />
  </bean>

</beans>