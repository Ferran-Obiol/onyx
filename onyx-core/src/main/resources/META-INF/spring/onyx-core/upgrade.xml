<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">

  <bean id="upgradeManager" class="org.obiba.runtime.upgrade.support.DefaultUpgradeManager">
     <property name="currentVersionProvider">
       <bean class="org.obiba.onyx.runtime.upgrade.OnyxVersionModifier">
          <property name="datasource" ref="dataSource"/>
          <property name="versionBeingInstalled" ref="version"/>          
       </bean>
     </property>
     <property name="runtimeVersionProvider">
       <bean class="org.obiba.onyx.runtime.upgrade.OnyxVersionProvider">
          <property name="version" ref="version"/>
       </bean>
     </property>
     <property name="upgradeSteps">
        <list>
          <ref bean="upgrade-to-1.3.0" />
          <ref bean="ruby-schemaUpgrade-1.4.0" />
          <ref bean="ruby-dataUpgrade-1.4.0" />
        </list>
     </property>
     <property name="stepListeners">
        <list>
          <bean class="org.obiba.runtime.upgrade.support.LoggingUpgradeStepExecutionListener"/>
        </list>
     </property>
  </bean>
    
  <bean id="upgrade-to-1.3.0" class="org.obiba.onyx.runtime.upgrade.support.SqlScriptUpgradeStep">
    <property name="dataSource" ref="dataSource"/>
    <property name="script" value="classpath:/upgrade-script/upgrade-1.3.0.sql"/>
    <property name="description" value="Upgrade Onyx to 1.3.0"/>
    <property name="appliesTo">
      <bean class="org.obiba.onyx.runtime.upgrade.support.VersionBeanVersionProvider">
        <property name="version" value="1.3.0"/>
      </bean>      
    </property>     
  </bean>  
  
  <bean id="ruby-schemaUpgrade-1.4.0" class="org.obiba.onyx.runtime.upgrade.support.SqlScriptUpgradeStep">
    <property name="description" value="Ruby Schema Upgrade 1.4.0"/>
    <property name="appliesTo">
      <bean class="org.obiba.onyx.runtime.upgrade.support.VersionBeanVersionProvider">
        <property name="version" value="1.4.0" />
      </bean>      
    </property>
    
    <property name="dataSource" ref="dataSource" />
    <property name="script" value="classpath:/upgrade-script/ruby-schemaUpgrade-1.4.0.sql" />
  </bean>
  
  <bean id="ruby-dataUpgrade-1.4.0" class="org.obiba.onyx.ruby.runtime.upgrade.DataUpgrade_1_4_0">
    <property name="description" value="Ruby Data Upgrade 1.4.0"/>
    <property name="appliesTo">
      <bean class="org.obiba.onyx.runtime.upgrade.support.VersionBeanVersionProvider">
        <property name="version" value="1.4.0" />
      </bean>      
    </property>
    
    <property name="dataSource" ref="dataSource" />
  </bean>
  
</beans>